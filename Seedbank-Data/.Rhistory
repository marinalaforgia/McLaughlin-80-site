SBquant.12 <- ddply(sb.2012, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant.14 <- ddply(sb.2014, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant <- merge(SBquant.12, SBquant.14, by = "Species_Name", all = T)
SBquant[is.na(SBquant)]<-0
SBquant$Tot.ab <- rowSums(SBquant[,2:3], na.rm=F)
#merge datasets
Index2<- merge(SBquant[,c(1,4)], ind2, by = "Species_Name", all = T)
###Alter datasets for Relative abundance
# Cover
cover.post2006<-na.omit(cover)
cover.post2006<- ddply(cover.post2006, c("Site","Year","Species_Name"), summarize, Cover = sum(Cover))
cover.post2006 <- merge(cover.post2006, ddply(cover.post2006, c("Site","Year"), summarize, Tot.cov = sum(Cover)), by=c("Site","Year"), all.x =T)
cover.post2006$RA <- cover.post2006$Cover/cover.post2006$Tot.cov*100
cover.RA <- ddply(cover.post2006, "Species_Name", summarize, RA = mean(RA))
# SB 2012: relative abundance in seedbank
RA.SB12 <- merge(sb.2012, ddply(sb.2012, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB12$RA12 <- RA.SB12$Count/RA.SB12$Tot.ab*100
RA.SB12 <- ddply(RA.SB12, "Species_Name", summarize, SB12 = mean(RA12))
# SB 2014
#test<-ddply(sb.2014, "Species_Name", summarize, Tot.ab = sum(Count))
RA.SB14 <- merge(sb.2014, ddply(sb.2014, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100
RA.SB14 <- ddply(RA.SB14, "Species_Name", summarize, SB14 = mean(RA14))
View(RA.SB14)
RA.SB14 <- merge(sb.2014, ddply(sb.2014, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100
View(RA.SB14)
View(sb.2012)
View(RA.SB12)
View(RA.SB14)
RA.SB12 <- merge(sb.2012, ddply(sb.2012, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
View(RA.SB12)
sb.2014 <- ddply(sb.2014, c("Site","Species_Name"), summarize, Count = sum(Count))
View(sb.2014)
####
#Alter datasets for frequency
####
# Cover (number of sites a species occurs in within a given year)
cover.freq <- ddply(cover, c("Year", "Species_Name"), summarize, freq.AB = length(unique(Site)))
cover.freq12 <- cover.freq[cover.freq$Year == 2012,]
cover.freq14 <- cover.freq[cover.freq$Year == 2014,]
colnames(cover.freq12)[3] <- "freq.AB12"
colnames(cover.freq14)[3] <- "freq.AB14"
AB.1214 <- merge(cover.freq12[,2:3],cover.freq14[,2:3],by = "Species_Name", all = T)
# SB 2012
SB12.freq <- ddply(sb.2012, "Species_Name", summarize, freq.SB12 = length(unique(Site)))
# SB 2014
SB14.freq <- ddply(sb.2014, "Species_Name", summarize, freq.SB14 = length(unique(Site)))
# Merge into one file
freq.SB <- merge(SB12.freq,SB14.freq,by = "Species_Name", all = T)
freq.all<- merge(freq.SB,AB.1214,by = "Species_Name", all = T)
#make NAs 0
freq.all[is.na(freq.all)]<-0
####
#Alter datasets for Index 2
####
# in the paper they dont have it as relative abundance in the seedbank, they have total abundance in the seedbank and cumulative cover of each species
#Cumulative cover (which might not necessarily make sense to avg cover across all 80 sites because of serpentine/nonserpentine)
cum.cover<-na.omit(cover)
ind2<-ddply(cum.cover, "Species_Name", summarize, cum.AB = sum(Cover)/length(unique(cum.cover$Year)))
#Total seeds in both years of sampling
SBquant.12 <- ddply(sb.2012, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant.14 <- ddply(sb.2014, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant <- merge(SBquant.12, SBquant.14, by = "Species_Name", all = T)
SBquant[is.na(SBquant)]<-0
SBquant$Tot.ab <- rowSums(SBquant[,2:3], na.rm=F)
#merge datasets
Index2<- merge(SBquant[,c(1,4)], ind2, by = "Species_Name", all = T)
cover.post2006<-na.omit(cover)
cover.post2006<- ddply(cover.post2006, c("Site","Year","Species_Name"), summarize, Cover = sum(Cover))
cover.post2006 <- merge(cover.post2006, ddply(cover.post2006, c("Site","Year"), summarize, Tot.cov = sum(Cover)), by=c("Site","Year"), all.x =T)
cover.post2006$RA <- cover.post2006$Cover/cover.post2006$Tot.cov*100
cover.RA <- ddply(cover.post2006, "Species_Name", summarize, RA = mean(RA))
# SB 2012: relative abundance in seedbank
RA.SB12 <- merge(sb.2012, ddply(sb.2012, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB12$RA12 <- RA.SB12$Count/RA.SB12$Tot.ab*100
RA.SB12 <- ddply(RA.SB12, "Species_Name", summarize, SB12 = mean(RA12))
# SB 2014
RA.SB14 <- merge(sb.2014, ddply(sb.2014, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100
RA.SB14 <- ddply(RA.SB14, "Species_Name", summarize, SB14 = mean(RA14))
View(RA.SB12)
View(RA.SB14)
RA.all <- merge(RA.SB14, RA.SB12, by = "Species_Name")
View(RA.all)
rowMeans(merge(RA.SB14, RA.SB12, by = "Species_Name")
)
merge(RA.SB14, RA.SB12, by = "Species_Name")
SB<-merge(RA.SB14, RA.SB12, by = "Species_Name")
SB.RA$RA.SB <- rowMeans(SB.RA[,2:3])
SB.RA <-merge(RA.SB14, RA.SB12, by = "Species_Name")
SB.RA$RA.SB <- rowMeans(SB.RA[,2:3])
View(SB.RA)
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name"))
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name")
View(RA.all)
SAI$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
#####
#Calculate SAI Index 1 (SBfreq / (SBfreq + ABfreq)) * 100 (SAI INDEX 1)
####
# Index 1 "relates the plot frequency of a certain species in above ground vegetation with its frequency in the soil seed bank"
# this doesn't specify how this is calculated in relation to the various years
# Index 1: 2012
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
#####
#Calculate SAI Index 2 (SBquant / (SBquant + ABcover)) * 100 (SAI INDEX 1)
####
# Index 2: "Relates the cumulative cover of a certain species over all plots to the total number of seeds recorded in the seed bank over all plots in both years of sampling"
# "Cover was calculated as an average of three years" for us this would be 10 years (cover)
Index2$SAI2 <- Index2$Tot.ab / (Index2$Tot.ab + Index2$cum.AB) * 100
####
# OVERALL SAI = average(index 1, index 2)
####
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
SAI$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI<-na.omit(SAI)
View(SAI)
View(RA.all)
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
View(RA.all)
test <- merge(RA.all[,c(1,6)],SAI,by="Species_Name",all=T)
View(test)
plot(test$SAI3 ~ test$SAI)
plot(test$SAI3 ~ test$SAI)
plot(test$SAI3 ~ test$SAI1)
plot(test$SAI3 ~ test$SAI2)
plot(test$SAI1 ~ test$SAI2)
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
par(mfrow=c(2,2))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
traits <- read.csv(file.choose())
SLA.SAIplot <- merge(traits[,c("Species_Name","SLAS","SLANS")], SAI[,c("Species_Name","SAI")], by = "Species_Name")
# SLA values change for serpentine and nonserpentine, so for overall I will look at the average but for many species it might be a good idea to calculate SAI separately (esp if looking at relative abundance on two very different soil types where the species vary so much)
par(mfrow=c(2,2))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA)
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
abline(lm(LA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
)
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS), col = "red")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA)
# relative abundance aboveground and belowground
par(mfrow=c(3,1))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS), col = "red")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS), col = "red")
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
par(mfrow=c(1,1))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
View(SLA.SAIplot)
View(SAI)
View(test)
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name",all=T)
View(SAI)
sb.2012[sb.2012$Species_Name == "Aira caryophyllea",]
sb.2014[sb.2014$Species_Name == "Aira caryophyllea",]
cover[cover$Species_Name == "Aira caryophyllea",]
View(Index2)
sum(cover$Cover[cover$Species_Name == "Aira caryophyllea",])
sum(cover$Cover[cover$Species_Name == "Aira caryophyllea"])
sum(cover$Cover[cover$Species_Name == "Aira caryophyllea"], na.omit=T)
sum(cover$Cover[cover$Species_Name == "Aira caryophyllea"], na.rm=T)
487.9/9
1/54.2
RA.SB12 <- merge(sb.2012, ddply(sb.2012, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB12$RA12 <- RA.SB12$Count/RA.SB12$Tot.ab*100
RA.SB12 <- ddply(RA.SB12, "Species_Name", summarize, SB12 = mean(RA12))
# SB 2014
RA.SB14 <- merge(sb.2014, ddply(sb.2014, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100
RA.SB14 <- ddply(RA.SB14, "Species_Name", summarize, SB14 = mean(RA14))
# Merge into one file
SB.RA <-merge(RA.SB14, RA.SB12, by = "Species_Name", all = T)
SB.RA$RA.SB <- rowMeans(SB.RA[,2:3])
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name", all = T)
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
View(RA.all)
RA.all(is.na(RA.all)) <- 0
RA.all[is.na(RA.all)] <- 0
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name",all=T)
View(SAI)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
View(SAI)
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name",all=T)
View(SAI)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
SAI<-na.omit(SAI)
View(SAI)
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name", all = T)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
View(SAI)
freq.all<- merge(freq.SB,AB.1214,by = "Species_Name", all = T)
# Index 1: 2012
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
Index2$SAI2 <- Index2$Tot.ab / (Index2$Tot.ab + Index2$cum.AB) * 100
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
View(SAI)
SAI[,SAI$SAI2]
SAI[SAI$SAI2]
SAI<-na.omit(SAI[SAI$SAI2,])
View(SAI)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
na.omit(SAI$SAI2)
SAI[na.omit(SAI$SAI2),]
SAI[SAI$SAI2!=NA,]
SAI[SAI$SAI2!==NA,]
SAI[!which(SAI$SAI2=NA),]
SAI[!which(SAI$SAI2==NA),]
na.rm(SAI$SAI2)
na.omit(SAI$SAI2)
SAI[na.omit(SAI$SAI2),]
SAI[!is.na(SAI$SAI2),]
SAI<-SAI[!is.na(SAI$SAI2),]
colnames(SAI)<- c("Species_Name","SAI_Index1","SAI_Index2","SAI","SAI_RelAb")
write.table(SAI,"SAI.csv",sep=",",row.names=F)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
View(SAI)
freq.all[,c(1,8)]
View(SBquant)
View(freq.all)
freq.all[is.na(freq.all)] <- 0
View(freq.all)
freq.all<- merge(freq.SB,AB.1214,by = "Species_Name", all = T)
freq.all[is.na(freq.all)] <- 0
# Index 1: 2012
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
View(freq.all)
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
View(freq.all)
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
SAI<-SAI[!is.na(SAI$SAI2),]
colnames(SAI)<- c("Species_Name","SAI_Index1","SAI_Index2","SAI","SAI_RelAb")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
View(SAI)
View(RA.all)
SB.RA[is.na(SB.RA)]<-0
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name", all = T)
View(RA.all)
SB.RA <-merge(RA.SB14, RA.SB12, by = "Species_Name", all = T)
SB.RA[is.na(SB.RA)]<-0
SB.RA$RA.SB <- rowMeans(SB.RA[,2:3])
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name", all = T)
View(RA.all)
# Index 1: 2012
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
#####
#Calculate SAI Index 2 (SBquant / (SBquant + ABcover)) * 100
####
# Index 2: "Relates the cumulative cover of a certain species over all plots to the total number of seeds recorded in the seed bank over all plots in both years of sampling"
# "Cover was calculated as an average of three years" for us this would be the average cumulative cover across 9 years
Index2$SAI2 <- Index2$Tot.ab / (Index2$Tot.ab + Index2$cum.AB) * 100
####
# OVERALL SAI = average(index 1, index 2)
####
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
SAI<-SAI[!is.na(SAI$SAI2),]
colnames(SAI)<- c("Species_Name","SAI_Index1","SAI_Index2","SAI","SAI_RelAb")
View(SAI)
write.table(SAI,"SAI.csv",sep=",",row.names=F)
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
View(SLA.SAIplot)
SLA.SAIplot <- merge(traits[,c("Species_Name","SLAS","SLANS")], SAI[,c("Species_Name","SAI","SAI_RelAb")], by = "Species_Name")
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
rm(list=ls())
####
#Clean up Data
####
library(plyr)
#Set working directory and load packages and files
setwd("~//Documents//UC Davis//02_McLaughlin_80Sites_Organized//Seedbank Data")
cover <- read.csv("~//Documents//UC Davis//02_McLaughlin_80Sites_Organized//Data Storage Files/Core_Community_Data2014.csv") #Core_Community_Data2014.csv
sb.2012 <- read.csv("SeedbankMcLaughlin_CLEANdata_20150126.csv") #SeedbankMcLaughlin_CLEANdata_20150126.csv
sb.2014 <- read.csv("SeedbankMcLaughlin2014CLEAN.csv") #SeedbankMcLaughlin2014CLEAN.csv
#extract columns needed
sb.2014<-sb.2014[,c(2:4)]
sb.2012<-sb.2012[,c(1,2,4,39)] #extract total seedlings per plot per species
sb.2012<-sb.2012[which(sb.2012$SUM>0),] #extract only species present
#check for name consistency
unique(sb.2012$Species_new[!sb.2012$Species_new%in%cover$Species_Name]) # 3 species found belowground not found aboveground
unique(sb.2014$Species.name[!sb.2014$Species.name%in%cover$Species_Name]) # 9 species found belowground not found aboveground
unique(cover$Species_Name[!cover$Species_Name%in%sb.2012$Species_new]) # many species found aboveground but not below
unique(cover$Species_Name[!cover$Species_Name%in%sb.2014$Species.name]) # many species found aboveground but not below
#change column names
colnames(sb.2012)<-c("Site","Soil","Species_Name","Count")
colnames(sb.2014)<-c("Site","Species_Name","Count")
#substitute Nemophila sp for Nemophila heterophylla
cover[which(cover$Species_Name=="Nemophila sp"),]$Species_Name <- "Nemophila heterophylla"
#remove abiotic
cover <- cover[which(!cover$Species_Name=="Bare"&!cover$Species_Name=="Rock"),]
#look at poorly identified species
NoID<- c("Calochortus sp.", "Vulpia sp.","bulb","Bromus sp.","unknown grass","Unknown grass","unknown forb","Unknown forb","Juncus sp.")
sb.2012[which(sb.2012$Species_Name%in%NoID),] # just five occurrences
#NotSpData <- sb.2012[which(sb.2012$Species_Name%in%NoID),]
#Bromus in site 65 unclear, both B. diandrus and hordaceous noted in seedling count already
#cover[which(cover$Species_Name%in%cover$Species_Name[grep("Bromus", cover$Species_Name)] & cover$Site==65),]
#sb.2012[which(sb.2012$Site==65),]
# Calochortus probably luteus
#cover[which(cover$Species_Name%in%cover$Species_Name[grep("Calochortus", cover$Species_Name)] & cover$Site==3),]
#sb.2012[which(sb.2012$Site==3),]
sb.2012[which(sb.2012$Site==3 & sb.2012$Species_Name=="Calochortus sp."),]$Species_Name <-"Calochortus luteus"
#Juncus unclear
cover[which(cover$Species_Name%in%cover$Species_Name[grep("Juncus", cover$Species_Name)]&cover$Site==37),]#no juncus
sb.2012[which(sb.2012$Site==37),] #unclear, possibly bufonius or phaeocephalus but no way to be sure
#seems likely to be Vulpia microstachys
cover[which(cover$Species_Name%in%cover$Species_Name[grep("Vulpia", cover$Species_Name)]&cover$Site==46),]
sb.2012[which(sb.2012$Site==46),]
sb.2012[which(sb.2012$Site==46&sb.2012$Species_Name=="Vulpia sp."),]$Species_Name <-"Vulpia microstachys"
sb.2014[which(sb.2014$Species_Name%in%NoID),] # many occurences of unknown grass/unknown forb/unknown bulb
#remove unknowns
rm.sp <- c("bulb","Bromus sp.","unknown grass","Unknown grass","unknown forb","Unknown forb","Juncus sp.","Centaurea sp.")
sb.2012 <- sb.2012[which(!sb.2012$Species_Name%in%rm.sp),]
sb.2014 <- sb.2014[which(!sb.2014$Species_Name%in%rm.sp),]
cover <- cover[which(!cover$Species_Name%in%rm.sp),]
#add up counts in seedbanks
sb.2012 <- ddply(sb.2012, c("Site","Species_Name"), summarize, Count = sum(Count))
sb.2014 <- ddply(sb.2014, c("Site","Species_Name"), summarize, Count = sum(Count))
####
#Alter datasets for frequency
####
# Cover (number of sites a species occurs in within a given year)
cover.freq <- ddply(cover, c("Year", "Species_Name"), summarize, freq.AB = length(unique(Site)))
cover.freq12 <- cover.freq[cover.freq$Year == 2012,]
cover.freq14 <- cover.freq[cover.freq$Year == 2014,]
colnames(cover.freq12)[3] <- "freq.AB12"
colnames(cover.freq14)[3] <- "freq.AB14"
AB.1214 <- merge(cover.freq12[,2:3],cover.freq14[,2:3],by = "Species_Name", all = T)
# SB 2012
SB12.freq <- ddply(sb.2012, "Species_Name", summarize, freq.SB12 = length(unique(Site)))
# SB 2014
SB14.freq <- ddply(sb.2014, "Species_Name", summarize, freq.SB14 = length(unique(Site)))
# Merge into one file
freq.SB <- merge(SB12.freq,SB14.freq,by = "Species_Name", all = T)
freq.all<- merge(freq.SB,AB.1214,by = "Species_Name", all = T)
freq.all[is.na(freq.all)] <- 0 # is the absence of a species for the seedbank sampling indicative of sampling error, thus the index should be calculated using only the year in which it appears, or is it indicative of absence from the seedbank so the measure should be averaged with 0? I lean towards the first one.
####
#Alter datasets for Index 2
####
# in the paper they dont have it as relative abundance in the seedbank, they have total abundance in the seedbank and cumulative cover of each species
#Cumulative cover (which might not necessarily make sense to avg cover across all 80 sites because of serpentine/nonserpentine)
cum.cover<-na.omit(cover)
ind2<-ddply(cum.cover, "Species_Name", summarize, cum.AB = sum(Cover)/length(unique(cum.cover$Year)))
#Total seeds in both years of sampling
SBquant.12 <- ddply(sb.2012, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant.14 <- ddply(sb.2014, "Species_Name", summarize, Tot.ab = sum(Count))
SBquant <- merge(SBquant.12, SBquant.14, by = "Species_Name", all = T)
SBquant[is.na(SBquant)]<-0
SBquant$Tot.ab <- rowSums(SBquant[,2:3], na.rm=F)
#merge datasets
Index2<- merge(SBquant[,c(1,4)], ind2, by = "Species_Name", all = T)
####
#Alter datasets for Relative abundance
####
# Cover
cover.post2006<-na.omit(cover)
cover.post2006<- ddply(cover.post2006, c("Site","Year","Species_Name"), summarize, Cover = sum(Cover))
cover.post2006 <- merge(cover.post2006, ddply(cover.post2006, c("Site","Year"), summarize, Tot.cov = sum(Cover)), by=c("Site","Year"), all.x =T)
cover.post2006$RA <- cover.post2006$Cover/cover.post2006$Tot.cov*100
cover.RA <- ddply(cover.post2006, "Species_Name", summarize, RA = mean(RA))
# SB 2012: relative abundance in seedbank
RA.SB12 <- merge(sb.2012, ddply(sb.2012, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB12$RA12 <- RA.SB12$Count/RA.SB12$Tot.ab*100
RA.SB12 <- ddply(RA.SB12, "Species_Name", summarize, SB12 = mean(RA12))
# SB 2014
RA.SB14 <- merge(sb.2014, ddply(sb.2014, "Site", summarize, Tot.ab = sum(Count)), by="Site", all.x =T)
RA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100
RA.SB14 <- ddply(RA.SB14, "Species_Name", summarize, SB14 = mean(RA14))
# Merge into one file
SB.RA <-merge(RA.SB14, RA.SB12, by = "Species_Name", all = T)
SB.RA[is.na(SB.RA)]<-0
SB.RA$RA.SB <- rowMeans(SB.RA[,2:3])
RA.all <- merge(cover.RA, SB.RA, by = "Species_Name", all = T)
#####
#Calculate SAI Index 1 (SBfreq / (SBfreq + ABfreq)) * 100 (SAI INDEX 1)
####
# Index 1 "relates the plot frequency of a certain species in above ground vegetation with its frequency in the soil seed bank"
# this doesn't specify how this is calculated in relation to the various years
# Index 1: 2012
freq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100
# Index 1: 2014
freq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100
# Index 1 average
freq.all$SAI1 <- rowMeans(freq.all[,6:7])
#####
#Calculate SAI Index 2 (SBquant / (SBquant + ABcover)) * 100
####
# Index 2: "Relates the cumulative cover of a certain species over all plots to the total number of seeds recorded in the seed bank over all plots in both years of sampling"
# "Cover was calculated as an average of three years" for us this would be the average cumulative cover across 9 years
Index2$SAI2 <- Index2$Tot.ab / (Index2$Tot.ab + Index2$cum.AB) * 100
####
# OVERALL SAI = average(index 1, index 2)
####
SAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by="Species_Name")
SAI$SAI <- rowMeans(SAI[,2:3])
#belowground freq/total frequency averaged across years?
####
# SAI using relative abundance belowground vs relative cover aboveground
####
RA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100
SAI <- merge(SAI,RA.all[,c(1,6)],by="Species_Name")
SAI<-SAI[!is.na(SAI$SAI2),]
colnames(SAI)<- c("Species_Name","SAI_Index1","SAI_Index2","SAI","SAI_RelAb")
View(SAI)
# Look at correlation of SLA with SAI
traits <- read.csv(file.choose())
SLA.SAIplot <- merge(traits[,c("Species_Name","SLAS","SLANS")], SAI[,c("Species_Name","SAI","SAI_RelAb")], by = "Species_Name")
# SLA values change for serpentine and nonserpentine, so for overall I will look at the average but for many species it might be a good idea to calculate SAI separately (esp if looking at relative abundance on two very different soil types where the species vary so much)
par(mfrow=c(1,1))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS), col = "red")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS), col = "red")
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
# Look at correlation of SLA with SAI
traits <- read.csv(file.choose())
SLA.SAIplot <- merge(traits[,c("Species_Name","SLAS","SLANS")], SAI[,c("Species_Name","SAI","SAI_RelAb")], by = "Species_Name")
# SLA values change for serpentine and nonserpentine, so for overall I will look at the average but for many species it might be a good idea to calculate SAI separately (esp if looking at relative abundance on two very different soil types where the species vary so much)
par(mfrow=c(1,1))
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS), col = "red")
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS), col = "red")
SLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])
plot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
abline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = "red")
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = "SLA", ylab="SAI")
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SAI, xlab = "SAI", ylab="SAI_relab")
plot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SAI_Index2, xlab = "SAI", ylab="SAI_relab")
plot(SAI$SAI_RelAb ~ SAI$SAI_Index2, xlab = "SAI", ylab="SAI_relab")
