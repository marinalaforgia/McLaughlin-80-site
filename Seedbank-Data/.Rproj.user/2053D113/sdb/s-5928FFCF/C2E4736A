{
    "contents" : "# Calculating Seed Accumulation index (Holzel & Otte)\n\n#Plan\n#1. Clean up Data\n#2. Calculate SAI index 1 in 2012 using aboveground freq in 2012\n#3. Calculate SAI in 2014 using aboveground freq in 2014\n#4. Calculate mean SAI across 2012 and 2014\n#5. Calculate SAI in 2012 using avg aboveground freq 2000-2012\n#6. Calculate SAI in 2014 using avg aboveground freq 2000-2014\n#7. Calculate mean SAI in 2012 and 2014 using avg long term freq\n#8. Export SAIs to csv file\n\n####\n#Clean up Data\n####\nlibrary(plyr)\nlibrary(dplyr)\n#Set working directory and load packages and files\n#setwd(\"~//Documents//UC Davis//02_McLaughlin_80Sites_Organized//Seedbank Data\")\ncover <- read.csv(\"~//Documents//UC-Davis//02_McLaughlin_80Sites_Organized//Data-Storage-Files/Core_Community_Data2014.csv\") #Core_Community_Data2014.csv\nsb.2012 <- read.csv(\"SeedbankMcLaughlin_CLEANdata_20150126.csv\") #SeedbankMcLaughlin_CLEANdata_20150126.csv\nsb.2014 <- read.csv(\"SeedbankMcLaughlin2014CLEAN.csv\") #SeedbankMcLaughlin2014CLEAN.csv\nabio <- read.csv(\"~//Documents//UC-Davis//02_McLaughlin_80Sites_Organized//Data-Storage-Files/Basic Abiotic Data.csv\")\ntraits <- read.csv(\"~//Documents//UC-Davis//02_McLaughlin_80Sites_Organized//Modified_CombinedFiles/McL_80SitesSpeciesTraits_012615.csv\")\n\n#extract columns needed\nsb.2014<-sb.2014[,c(2:4)]\nsb.2012<-sb.2012[,c(1,2,4,39)] #extract total seedlings per plot per species\nsb.2012<-sb.2012[which(sb.2012$SUM>0),] #extract only species present\n\n#change column names\ncolnames(sb.2012)<-c(\"Site\",\"Soil\",\"Species_Name\",\"Count\")\ncolnames(sb.2014)<-c(\"Site\",\"Species_Name\",\"Count\")\n\n#change capitalization of unknown forb/grass for consistency \nlevels(sb.2014$Species_Name) <- c(levels(sb.2014$Species_Name), \"Unknown grass\", \"Unknown forb\")\nsb.2014[which(sb.2014$Species_Name == \"unknown grass\"),2] <- \"Unknown grass\"\nsb.2014[which(sb.2014$Species_Name == \"unknown forb\"),2] <- \"Unknown forb\"\n\n#check for name consistency\nunique(sb.2012$Species_Name[!sb.2012$Species_Name%in%cover$Species_Name]) # 3 species found belowground not found aboveground: Calochortus sp, Vulpia sp., Bromus sp.\nunique(sb.2014$Species_Name[!sb.2014$Species_Name%in%cover$Species_Name]) # 9 species found belowground not found aboveground: Draba verna, Lythrum californicum, bulb, Juncus phaeocephalus, Solanum nigrum, Veronica peregrina, Epilobium ciliatum; note: epilobium ciliatum and juncus phaeo. are perennials  \nunique(cover$Species_Name[!cover$Species_Name%in%sb.2012$Species_Name]) # many species found aboveground but not below in 2012\nunique(cover$Species_Name[!cover$Species_Name%in%sb.2014$Species_Name]) # many species found aboveground but not below in 2014\n\n#clean up cover data\n  # to investigate: Centaurea sp, Nemophila sp, Minuartia sp., Stephanmeria sp., \n  #substitute Nemophila sp for Nemophila heterophylla\n  cover[which(cover$Species_Name==\"Nemophila sp\"),]$Species_Name <- \"Nemophila heterophylla\"\n  # Other minuartia species not present in quadrat in previous years\n  filter(cover, Site == 38, Quadrat == 4, Species_Name == \"Minuartia californica\" | Species_Name == \"Minuartia douglasii\")\n  # look into centaurea sp.; no matching centaurea species in that quadrat\n  cover[which(cover$Species_Name == \"Centaurea sp.\"),]\nfilter(cover, Site == 31, Quadrat == 5, Species_Name == \"Centaurea solstitialis\" | Species_Name == \"Centaurea melitensis\")\n #remove abiotic \n  cover <- cover[which(!cover$Species_Name==\"Bare\"&!cover$Species_Name==\"Rock\"),]\n\n#look at poorly identified species in seedbank\nNoID<- c(\"Calochortus sp.\", \"Vulpia sp.\",\"bulb\",\"Bromus sp.\",\"Unknown grass\",\"Unknown forb\",\"Juncus sp.\") \nsb.2012[which(sb.2012$Species_Name%in%NoID),] # just five occurrences \n  #Bromus in site 65 unclear, both B. diandrus and hordaceous noted in seedling count already\n  cover[which(cover$Species_Name%in%cover$Species_Name[grep(\"Bromus\", cover$Species_Name)] & cover$Site==65),]\n  sb.2012[which(sb.2012$Site==65),]\n  \n  # Calochortus probably luteus\n  #cover[which(cover$Species_Name%in%cover$Species_Name[grep(\"Calochortus\", cover$Species_Name)] & cover$Site==3),]\n  #sb.2012[which(sb.2012$Site==3),]\n  sb.2012[which(sb.2012$Site==3 & sb.2012$Species_Name==\"Calochortus sp.\"),]$Species_Name <-\"Calochortus luteus\"\n  \n  #seems likely to be Vulpia microstachys\n  cover[which(cover$Species_Name%in%cover$Species_Name[grep(\"Vulpia\", cover$Species_Name)]&cover$Site==46),]\n  sb.2012[which(sb.2012$Site==46),] \n  sb.2012[which(sb.2012$Site==46&sb.2012$Species_Name==\"Vulpia sp.\"),]$Species_Name <-\"Vulpia microstachys\"\n  \nsb.2014[which(sb.2014$Species_Name%in%NoID),] # many occurences of unknown grass/unknown forb/unknown bulb\n\n# Remove perennial species \"Juncus phaeocephalus\",\"Epilobium ciliatum\"  \nsb.2014 <- sb.2014[which(!sb.2014$Species_Name == \"Juncus phaeocephalus\" | !sb.2014$Species_Name == \"Epilobium ciliatum\"),]\n\n#remove unknowns\n#sb.2012 <- sb.2012[which(!sb.2012$Species_Name%in%NoID),] \n#sb.2014 <- sb.2014[which(!sb.2014$Species_Name%in%NoID),]\n#cover <- cover[which(!cover$Species_Name%in%rm.sp),]\n\n#add up counts in seedbanks\nsb.2012 <- ddply(sb.2012, c(\"Site\",\"Species_Name\"), summarize, Count = sum(Count))\nsb.2014 <- ddply(sb.2014, c(\"Site\",\"Species_Name\"), summarize, Count = sum(Count))\n\n#### \n#Alter datasets for frequency\n####\n# Cover (number of sites a species occurs in within a given year)\ncover.freq <- ddply(cover, c(\"Year\", \"Species_Name\"), summarize, freq.AB = length(unique(Site))) \ncover.freq12 <- cover.freq[cover.freq$Year == 2012,]\ncover.freq14 <- cover.freq[cover.freq$Year == 2014,]\ncolnames(cover.freq12)[3] <- \"freq.AB12\"\ncolnames(cover.freq14)[3] <- \"freq.AB14\"\nAB.1214 <- merge(cover.freq12[,2:3],cover.freq14[,2:3],by = \"Species_Name\", all = T)\n\n# SB 2012\nSB12.freq <- ddply(sb.2012, \"Species_Name\", summarize, freq.SB12 = length(unique(Site)))   \n\n# SB 2014\nSB14.freq <- ddply(sb.2014, \"Species_Name\", summarize, freq.SB14 = length(unique(Site))) \n\n# Merge into one file\nfreq.SB <- merge(SB12.freq,SB14.freq,by = \"Species_Name\", all = T)\nfreq.all<- merge(freq.SB,AB.1214,by = \"Species_Name\", all = T)\nfreq.all[is.na(freq.all)] <- 0 # is the absence of a species for the seedbank sampling indicative of sampling error, thus the index should be calculated using only the year in which it appears, or is it indicative of absence from the seedbank so the measure should be averaged with 0? I lean towards the first one.\n\n####  \n#Alter datasets for Index 2\n####\n# in the paper they dont have it as relative abundance in the seedbank, they have total abundance in the seedbank and cumulative cover of each species\n\n#Cumulative cover (which might not necessarily make sense to avg cover across all 80 sites because of serpentine/nonserpentine)\ncum.cover<-na.omit(cover)\nind2<-ddply(cum.cover, \"Species_Name\", summarize, cum.AB = sum(Cover)/length(unique(cum.cover$Year)))\n\n#Total seeds in both years of sampling\nSBquant.12 <- ddply(sb.2012, \"Species_Name\", summarize, Tot.ab = sum(Count))\nSBquant.14 <- ddply(sb.2014, \"Species_Name\", summarize, Tot.ab = sum(Count))\nSBquant <- merge(SBquant.12, SBquant.14, by = \"Species_Name\", all = T)\nSBquant[is.na(SBquant)]<-0\nSBquant$Tot.ab <- rowSums(SBquant[,2:3], na.rm=F)\n\n#merge datasets\nIndex2<- merge(SBquant[,c(1,4)], ind2, by = \"Species_Name\", all = T)\n\n####\n#Alter datasets for Relative abundance\n####\n# Cover\ncover.post2006<-na.omit(cover)\ncover.post2006<- ddply(cover.post2006, c(\"Site\",\"Year\",\"Species_Name\"), summarize, Cover = sum(Cover))\ncover.post2006 <- merge(cover.post2006, ddply(cover.post2006, c(\"Site\",\"Year\"), summarize, Tot.cov = sum(Cover)), by=c(\"Site\",\"Year\"), all.x =T)\ncover.post2006$RA <- cover.post2006$Cover/cover.post2006$Tot.cov*100\n\ncover.RA <- ddply(cover.post2006, \"Species_Name\", summarize, RA = mean(RA))\n\n# SB 2012: relative abundance in seedbank\nRA.SB12 <- merge(sb.2012, ddply(sb.2012, \"Site\", summarize, Tot.ab = sum(Count)), by=\"Site\", all.x =T)\nRA.SB12$RA12 <- RA.SB12$Count/RA.SB12$Tot.ab*100\nRA.SB12 <- ddply(RA.SB12, \"Species_Name\", summarize, SB12 = mean(RA12))\n\n# SB 2014\nRA.SB14 <- merge(sb.2014, ddply(sb.2014, \"Site\", summarize, Tot.ab = sum(Count)), by=\"Site\", all.x =T)\nRA.SB14$RA14 <- RA.SB14$Count/RA.SB14$Tot.ab*100\nRA.SB14 <- ddply(RA.SB14, \"Species_Name\", summarize, SB14 = mean(RA14))\n\n# Merge into one file\nSB.RA <-merge(RA.SB14, RA.SB12, by = \"Species_Name\", all = T)\nSB.RA[is.na(SB.RA)]<-0\nSB.RA$RA.SB <- rowMeans(SB.RA[,2:3])\nRA.all <- merge(cover.RA, SB.RA, by = \"Species_Name\", all = T)\n\n\n#####\n#Calculate SAI Index 1 (SBfreq / (SBfreq + ABfreq)) * 100 (SAI INDEX 1)\n####\n# Index 1 \"relates the plot frequency of a certain species in above ground vegetation with its frequency in the soil seed bank\"\n# this doesn't specify how this is calculated in relation to the various years\n\n# Index 1: 2012\nfreq.all$SAI1.2012 <- (freq.all$freq.SB12 / (freq.all$freq.SB12 + freq.all$freq.AB12)) * 100\n\n# Index 1: 2014\nfreq.all$SAI1.2014 <- (freq.all$freq.SB14 / (freq.all$freq.SB14 + freq.all$freq.AB14)) * 100\n\n# Index 1 average\nfreq.all$SAI1 <- rowMeans(freq.all[,6:7])\n\n#####\n#Calculate SAI Index 2 (SBquant / (SBquant + ABcover)) * 100\n####\n# Index 2: \"Relates the cumulative cover of a certain species over all plots to the total number of seeds recorded in the seed bank over all plots in both years of sampling\"\n# \"Cover was calculated as an average of three years\" for us this would be the average cumulative cover across 9 years\nIndex2$SAI2 <- Index2$Tot.ab / (Index2$Tot.ab + Index2$cum.AB) * 100\n\n####\n# OVERALL SAI = average(index 1, index 2)\n####\nSAI <- merge(freq.all[,c(1,8)],Index2[,c(1,4)],by=\"Species_Name\")\nSAI$SAI <- rowMeans(SAI[,2:3])\n#belowground freq/total frequency averaged across years? \n\n####\n# SAI using relative abundance belowground vs relative cover aboveground\n####\nRA.all$SAI3 <- RA.all$RA.SB / (RA.all$RA.SB + RA.all$RA) * 100\nSAI <- merge(SAI,RA.all[,c(1,6)],by=\"Species_Name\")\n\nSAI<-SAI[!is.na(SAI$SAI2),]\ncolnames(SAI)<- c(\"Species_Name\",\"SAI_Index1\",\"SAI_Index2\",\"SAI\",\"SAI_RelAb\")\n\n#### Seedbank by year\nsb.2012$Year <- 2012\nsb.2014$Year <- 2014\nsb.by.year <- rbind(sb.2012,sb.2014)\nsb.by.year <- merge(abio[,2:3], sb.by.year, by.x = \"site\", by.y = \"Site\")\nsb.by.year <- merge(sb.by.year, traits[,c(\"Species_Name\", \"Grass.Forb.Shrub\")], by = \"Species_Name\", all.x = T)\nsb.by.year[which(sb.by.year$Species_Name == \"bulb\"),6] <- \"Forb\"\nsb.by.year[which(sb.by.year$Species_Name == \"Unknown forb\"),6] <- \"Forb\"\nsb.by.year[which(sb.by.year$Species_Name == \"Unknown grass\"),6] <- \"Grass\"\nsb.by.year[which(sb.by.year$Species_Name == \"Bromus sp.\"),6] <- \"Grass\"\nsb.by.year[which(sb.by.year$Species_Name == \"Aegilops triuncialis\"),6] <- \"Grass\"\nsb.by.year <- filter(sb.by.year, Grass.Forb.Shrub != \"Shrub\")\nsb.by.year.sum <- ddply(sb.by.year, c(\"Serpentine\",\"Species_Name\",\"Grass.Forb.Shrub\",\"Year\"), summarize, Count = sum(Count))\nggplot(sb.by.year.sum, aes(x = Year, y = Count)) + \n  geom_line(aes(by = Species_Name, col = Serpentine)) +\n  facet_wrap(~Grass.Forb.Shrub) +\n  geom_smooth(method = \"lm\", aes(col = Serpentine))\n\n####\n# SAI per Site\n###\ncolnames(sb.2012)[3] <- \"Count.12\"\ncolnames(sb.2014)[3] <- \"Count.14\"\nsb.both.yrs <- merge(sb.2012, sb.2014, by = c(\"Site\",\"Species_Name\"), all = T)\nsb.both.yrs[is.na(sb.both.yrs)] <- 0\nsb.both.yrs <- merge(abio[,2:3], sb.both.yrs, by.x = \"site\", by.y = \"Site\")\nsb.both.yrs <- merge(sb.both.yrs, traits[,c(\"Species_Name\", \"Grass.Forb.Shrub\")], by = \"Species_Name\", all.x = T)\nsb.both.yrs <- sb.both.yrs[,c(2,3,6,1,4,5)]\nsb.both.yrs <- sb.both.yrs[order(sb.both.yrs$site),]\nsb.both.yrs[which(sb.both.yrs$Species_Name%in%NoID),]\nsb.both.yrs[which(sb.both.yrs$Species_Name == \"bulb\"),3] <- \"Forb\"\nsb.both.yrs[which(sb.both.yrs$Species_Name == \"Unknown forb\"),3] <- \"Forb\"\nsb.both.yrs[which(sb.both.yrs$Species_Name == \"Unknown grass\"),3] <- \"Grass\"\nsb.both.yrs[which(sb.both.yrs$Species_Name == \"Bromus sp.\"),3] <- \"Grass\"\nsb.both.yrs[which(sb.both.yrs$Species_Name == \"Aegilops triuncialis\"),3] <- \"Grass\"\nSAIperSite <- merge(sb.both.yrs, SAI, by = \"Species_Name\")\nSAIperSite <- SAIperSite[,c(2,3,1,4:10)]\nSAIperSite <- SAIperSite[order(SAIperSite$site),]\nSAIperSite[is.na(SAIperSite),]\nwrite.table(SAIperSite, \"Seedbank_counts.csv\", sep = \",\", row.names = F)\n# SAI per species then calculate it per site? or calculate SAI individually for each site? how would this be done?\n\n\n####\n# PLOT SAI VS SLA\n####\n\n# Look at correlation of SLA with SAI\nSLA.SAIplot <- merge(traits[,c(\"Species_Name\",\"SLAS\",\"SLANS\")], SAI[,c(\"Species_Name\",\"SAI\",\"SAI_RelAb\")], by = \"Species_Name\")\n# SLA values change for serpentine and nonserpentine, so for overall I will look at the average but for many species it might be a good idea to calculate SAI separately (esp if looking at relative abundance on two very different soil types where the species vary so much)\npar(mfrow=c(1,1))\nplot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS)\nabline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLAS), col = \"red\")\nplot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS)\nabline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLANS), col = \"red\")\nSLA.SAIplot$SLA<-rowMeans(SLA.SAIplot[,2:3])\nplot(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA, xlab = \"SLA\", ylab=\"SAI\")\nabline(lm(SLA.SAIplot$SAI ~ SLA.SAIplot$SLA), col = \"red\")\nplot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SLA, xlab = \"SLA\", ylab=\"SAI\")\n\nplot(SLA.SAIplot$SAI_RelAb ~ SLA.SAIplot$SAI, xlab = \"SAI\", ylab=\"SAI_relab\")\nplot(SAI$SAI_RelAb ~ SAI$SAI_Index2, xlab = \"SAI\", ylab=\"SAI_relab\")\n\n# break out by functional groups \n# differences between freq and abundance index\n# SLA/SAI correlated with abundance over time\n# number of years seen aboveground\n\n####\n# Export Files\n###\nwrite.table(SAI,\"SAI.csv\",sep=\",\",row.names=F)\n\n",
    "created" : 1436480462896.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2368313717",
    "id" : "C2E4736A",
    "lastKnownWriteTime" : 1436733661,
    "path" : "~/Documents/UC-Davis/02_McLaughlin_80Sites_Organized/Seedbank-Data/SAI_062015.R",
    "project_path" : "SAI_062015.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}